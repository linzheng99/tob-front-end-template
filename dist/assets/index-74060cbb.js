import{aS as Z,aT as G,aH as R,aU as D,a5 as n,aV as M,e as q,f as v,am as H,j as O,J,aR as X,aW as I,a0 as K,Y as B,a4 as F,a7 as b,$ as E,aX as Q,aY as x,Z as ee,an as te,ao as ne,aZ as w,at as oe,aC as se,aj as k,aa as T,a8 as z,a_ as ae,ax as re,_ as le,aw as ue,av as ie,a$ as ce}from"./index-73a9b030.js";import{s as fe,c as pe}from"./createPlaceholder-2e1d68c3.js";function de({defaultFormModel:e,getSchema:m,formModel:c}){function g(f){if(!Z(f))return{};const a={};for(const r of Object.entries(f)){const[,s]=r,[p]=r;!p||G(s)&&s.length===0||R(s)||D(s)||fe(a,p,s)}return a}function i(){const f=n(m),a={};f.forEach(r=>{const{defaultValue:s}=r;D(s)||(a[r.field]=s,c[r.field]=s)}),e.value=a}return{handleFormValues:g,initDefault:i}}const me={gridProps:{type:Object,default:()=>({cols:2,xGap:20,yGap:0})},giProps:{type:Object,default:()=>({span:1})},labelWidth:{type:[Number,String],default:100},schemas:{type:[Array],default:()=>[]},inline:{type:Boolean,default:!1},size:{type:String,default:"medium"},labelPlacement:{type:String,default:"left"},requireMarkPlacement:{type:String,default:"left"},isFull:{type:Boolean,default:!0},showActionButtonGroup:{type:Boolean,default:!0},showSubmitButton:{type:Boolean,default:!0},submitButtonText:{type:String,default:"确认"},submitButtonOptions:Object,showResetButton:{type:Boolean,default:!0},resetButtonOptions:Object,resetButtonText:{type:String,default:"重置"}};function ge({emit:e,getProps:m,formModel:c,getSchema:g,formElRef:i,defaultFormModel:f,loadingSub:a,handleFormValues:r}){async function s(){var t;return(t=n(i))==null?void 0:t.validate()}async function p(t){t&&t.preventDefault(),a.value=!0;const{submitFunc:_}=n(m);if(_&&R(_)){try{await _()}catch(l){console.error(l)}finally{a.value=!1}return!1}if(!n(i))return!1;try{await s();const l=o();return a.value=!1,e("submit",l),l}catch(l){return e("submit",!1),a.value=!1,console.error(l),!1}}async function P(){var t;await((t=n(i))==null?void 0:t.restoreValidation())}async function y(){const{resetFunc:t}=n(m);if(t&&R(t)&&await t(),!n(i))return;Object.keys(c).forEach(l=>{c[l]=n(f)[l]||null}),await P();const d=r(M(n(c)));e("reset",d)}function o(){return n(i)?r(M(n(c))):{}}async function h(t){const _=n(g).map(d=>d.field).filter(Boolean);Object.keys(t).forEach(d=>{const l=t[d];_.includes(d)&&(c[d]=l)})}async function C(){return n(g)}function S(t){a.value=t}return{handleSubmit:p,validate:s,resetFields:y,getFieldsValue:o,restoreValidation:P,setFieldsValue:h,getFormSchema:C,setLoading:S}}const ye=q({name:"BasicFrom",components:{},props:{...me},emits:["reset","submit","register"],setup(e,{emit:m}){const c=v(null),g=v({}),i=H({}),f=v({}),a=v(null),r=v(!1),s=v(!1),p=O(()=>{const u={...e,...n(f)},j={rules:{}};return(u.schemas||[]).forEach(V=>{V.rules&&G(V.rules)&&(j.rules[V.field]=V.rules)}),{...u,...n(j)}}),P=O(()=>{const{gridProps:u}=n(p);return{...u}}),y=O(()=>n(a)||n(p).schemas),o=O(()=>Object.assign({size:e.size,type:"primary"},e.submitButtonOptions)),h=O(()=>Object.assign({size:e.size,type:"default"},e.resetButtonOptions)),{handleFormValues:C,initDefault:S}=de({defaultFormModel:g,getSchema:y,formModel:i}),{handleSubmit:t,validate:_,restoreValidation:d,resetFields:l,getFieldsValue:A,setFieldsValue:N,getFormSchema:U}=ge({emit:m,getProps:p,formModel:i,getSchema:y,formElRef:c,defaultFormModel:g,loadingSub:r,handleFormValues:C});async function L(u){f.value=I(n(f)||{},u)}function W(u){const j=u.componentProps??{},$=u.component;return{clearable:!0,placeholder:pe(n($)),...j}}const Y={validate:_,restoreValidation:d,setProps:L,resetFields:l,getFieldsValue:A,setFieldsValue:N,getFormSchema:U,submit:t};return J(()=>y.value,u=>{n(s)||u!=null&&u.length&&(S(),s.value=!0)},{deep:!0}),X(()=>{S(),m("register",Y)}),{formElRef:c,formModel:i,getSchema:y,getComponentProps:W,getGrid:P,getProps:p,loadingSub:r,handleSubmit:t,getSubmitBtnOptions:o,getResetBtnOptions:h,resetFields:l}}});function _e(e,m,c,g,i,f){const a=ae,r=re,s=le,p=ue,P=ie,y=ce;return B(),F(y,w(e.getProps,{ref:"formElRef",model:e.formModel}),{default:b(()=>[E(P,Q(x(e.getGrid)),{default:b(()=>[(B(!0),ee(te,null,ne(e.getSchema,o=>(B(),F(r,w(o.giProps||e.getProps.giProps,{key:o.field}),{default:b(()=>[E(a,{label:o.label,path:o.field,"show-label":o.showLabel},{default:b(()=>[o.slot?oe(e.$slots,o.slot,{key:0,model:e.formModel,field:o.field,value:e.formModel[o.field]}):o.component?(B(),F(se(o.component),w({key:1},e.getComponentProps(o),{value:e.formModel[o.field],"onUpdate:value":h=>e.formModel[o.field]=h,class:`${o.isFull!==!1&&e.getProps.isFull?"w-full":""}`}),null,16,["value","onUpdate:value","class"])):k("",!0)]),_:2},1032,["label","path","show-label"])]),_:2},1040))),128)),e.getProps.showActionButtonGroup?(B(),F(r,{key:0,span:24},{default:b(()=>[E(p,{justify:"center"},{default:b(()=>[e.getProps.showSubmitButton?(B(),F(s,w({key:0},e.getSubmitBtnOptions,{loading:e.loadingSub,onClick:e.handleSubmit}),{default:b(()=>[T(z(e.getProps.submitButtonText),1)]),_:1},16,["loading","onClick"])):k("",!0),e.getProps.showResetButton?(B(),F(s,w({key:1},e.getResetBtnOptions,{onClick:e.resetFields}),{default:b(()=>[T(z(e.getProps.resetButtonText),1)]),_:1},16,["onClick"])):k("",!0)]),_:1})]),_:1})):k("",!0)]),_:3},16)]),_:3},16,["model"])}const Pe=K(ye,[["render",_e]]);export{Pe as F};
