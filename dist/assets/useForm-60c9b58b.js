import{bE as H,bt as M,aJ as R,bF as D,a5 as n,bG as z,e as K,f as F,ao as W,j as B,J as T,aI as X,bH as Y,a0 as Z,Y as w,a4 as v,a8 as _,$ as C,bI as Q,bJ as x,Z as ee,ap as te,aq as ne,bx as O,aw as oe,aF as se,ah as k,ac as A,a9 as G,a$ as ae,aA as re,_ as le,az as ue,ay as ie,b0 as ce,bK as fe,X as de}from"./index-7b7dfb38.js";import{s as pe,c as me}from"./createPlaceholder-6fcd5da5.js";function ge({defaultFormModel:e,getSchema:u,formModel:a}){function i(p){if(!H(p))return{};const t={};for(const r of Object.entries(p)){const[,l]=r,[m]=r;!m||M(l)&&l.length===0||R(l)||D(l)||pe(t,m,l)}return t}function c(){const p=n(u),t={};p.forEach(r=>{const{defaultValue:l}=r;D(l)||(t[r.field]=l,a[r.field]=l)}),e.value=t}return{handleFormValues:i,initDefault:c}}const be={gridProps:{type:Object,default:()=>({cols:2,xGap:20,yGap:0})},giProps:{type:Object,default:()=>({span:1})},labelWidth:{type:[Number,String],default:100},labelAlign:{type:String,default:"right"},schemas:{type:[Array],default:()=>[]},inline:{type:Boolean,default:!1},size:{type:String,default:"medium"},labelPlacement:{type:String,default:"left"},requireMarkPlacement:{type:String,default:"left"},isFull:{type:Boolean,default:!0},showActionButtonGroup:{type:Boolean,default:!0},showSubmitButton:{type:Boolean,default:!0},submitButtonText:{type:String,default:"确认"},submitButtonOptions:Object,showResetButton:{type:Boolean,default:!0},resetButtonOptions:Object,resetButtonText:{type:String,default:"重置"}};function ye({emit:e,getProps:u,formModel:a,getSchema:i,formElRef:c,defaultFormModel:p,loadingSub:t,handleFormValues:r}){async function l(){var o;return(o=n(c))==null?void 0:o.validate()}async function m(o){o&&o.preventDefault(),t.value=!0;const{submitFunc:y}=n(u);if(y&&R(y)){try{await y()}catch(f){console.error(f)}finally{t.value=!1}return!1}if(!n(c))return!1;try{await l();const f=s();return t.value=!1,e("submit",f),f}catch(f){return e("submit",!1),t.value=!1,console.error(f),!1}}async function P(){var o;await((o=n(c))==null?void 0:o.restoreValidation())}async function b(){const{resetFunc:o}=n(u);if(o&&R(o)&&await o(),!n(c))return;Object.keys(a).forEach(f=>{a[f]=n(p)[f]||null}),await P();const g=r(z(n(a)));e("reset",g)}function s(){return n(c)?r(z(n(a))):{}}async function h(o){const y=n(i).map(g=>g.field).filter(Boolean);Object.keys(o).forEach(g=>{const f=o[g];y.includes(g)&&(a[g]=f)})}async function E(){return n(i)}function V(o){t.value=o}return{handleSubmit:m,validate:l,resetFields:b,getFieldsValue:s,restoreValidation:P,setFieldsValue:h,getFormSchema:E,setLoading:V}}const _e=K({name:"BasicFrom",components:{},props:{...be},emits:["reset","submit","register"],setup(e,{emit:u}){const a=F(null),i=F({}),c=W({}),p=F({}),t=F(null),r=F(!1),l=F(!1),m=B(()=>{const d={...e,...n(p)},S={rules:{}};return(d.schemas||[]).forEach(j=>{j.rules&&M(j.rules)&&(S.rules[j.field]=j.rules)}),{...d,...n(S)}}),P=B(()=>{const{gridProps:d}=n(m);return{...d}}),b=B(()=>n(t)||n(m).schemas),s=B(()=>Object.assign({size:e.size,type:"primary"},e.submitButtonOptions)),h=B(()=>Object.assign({size:e.size,type:"default"},e.resetButtonOptions)),{handleFormValues:E,initDefault:V}=ge({defaultFormModel:i,getSchema:b,formModel:c}),{handleSubmit:o,validate:y,restoreValidation:g,resetFields:f,getFieldsValue:N,setFieldsValue:L,getFormSchema:U}=ye({emit:u,getProps:m,formModel:c,getSchema:b,formElRef:a,defaultFormModel:i,loadingSub:r,handleFormValues:E});async function J(d){p.value=Y(n(p)||{},d)}function q(d){const S=d.componentProps??{},$=d.component;return{clearable:!0,placeholder:me(n($)),...S}}const I={validate:y,restoreValidation:g,setProps:J,resetFields:f,getFieldsValue:N,setFieldsValue:L,getFormSchema:U,submit:o};return T(()=>b.value,d=>{n(l)||d!=null&&d.length&&(V(),l.value=!0)},{deep:!0}),X(()=>{V(),u("register",I)}),{formElRef:a,formModel:c,getSchema:b,getComponentProps:q,getGrid:P,getProps:m,loadingSub:r,handleSubmit:o,getSubmitBtnOptions:s,getResetBtnOptions:h,resetFields:f}}});function Fe(e,u,a,i,c,p){const t=ae,r=re,l=le,m=ue,P=ie,b=ce;return w(),v(b,O(e.getProps,{ref:"formElRef",model:e.formModel}),{default:_(()=>[C(P,Q(x(e.getGrid)),{default:_(()=>[(w(!0),ee(te,null,ne(e.getSchema,s=>(w(),v(r,O({ref_for:!0},s.giProps||e.getProps.giProps,{key:s.field}),{default:_(()=>[C(t,{label:s.label,path:s.field,"show-label":s.showLabel},{default:_(()=>[s.slot?oe(e.$slots,s.slot,{key:0,model:e.formModel,field:s.field,value:e.formModel[s.field]}):s.component?(w(),v(se(s.component),O({key:1,ref_for:!0},e.getComponentProps(s),{value:e.formModel[s.field],"onUpdate:value":h=>e.formModel[s.field]=h,class:`${s.isFull!==!1&&e.getProps.isFull?"w-full":""}`}),null,16,["value","onUpdate:value","class"])):k("",!0)]),_:2},1032,["label","path","show-label"])]),_:2},1040))),128)),e.getProps.showActionButtonGroup?(w(),v(r,{key:0,span:24},{default:_(()=>[C(m,{justify:"center"},{default:_(()=>[e.getProps.showSubmitButton?(w(),v(l,O({key:0},e.getSubmitBtnOptions,{loading:e.loadingSub,onClick:e.handleSubmit}),{default:_(()=>[A(G(e.getProps.submitButtonText),1)]),_:1},16,["loading","onClick"])):k("",!0),e.getProps.showResetButton?(w(),v(l,O({key:1},e.getResetBtnOptions,{onClick:e.resetFields}),{default:_(()=>[A(G(e.getProps.resetButtonText),1)]),_:1},16,["onClick"])):k("",!0)]),_:1})]),_:1})):k("",!0)]),_:3},16)]),_:3},16,["model"])}const he=Z(_e,[["render",Fe]]);function we(e){const u={};return Object.keys(e).map(a=>u[a]=n(e[a])),u}function Be(e){const u=F(null),a=F(!1);async function i(){const t=n(u);return t||console.error("No instance form"),await de(),t}function c(t){fe(()=>{u.value=null,a.value=null}),!(n(a)&&t===n(u))&&(u.value=t,a.value=!0,T(()=>e,()=>{e&&t.setProps(we(e))},{immediate:!0,deep:!0}))}return[c,{setProps:async t=>{await(await i()).setProps(t)},getFieldsValue:()=>{var t;return(t=n(u))==null?void 0:t.getFieldsValue()},setFieldsValue:async t=>{await(await i()).setFieldsValue(t)},resetFields:async()=>{await(await i()).resetFields()},restoreValidation:async()=>{await(await i()).restoreValidation()},submit:async()=>(await i()).submit(),validate:async()=>(await i()).validate(),getFormSchema:async()=>(await i()).getFormSchema(),setLoading:async t=>{(await i()).setLoading(t)}}]}export{he as F,Be as u};
