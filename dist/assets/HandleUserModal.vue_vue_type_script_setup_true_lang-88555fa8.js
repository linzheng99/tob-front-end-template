import{u as y,F as _}from"./useForm-417a659a.js";import{M as v}from"./index-443f46b2.js";import{e as R,f as l,j as N,J as P,Y as F,a4 as I,a8 as x,$ as A,a5 as M,aZ as k,a_ as q,a$ as C,ar as U}from"./index-d0818fe1.js";import{g as S}from"./index-fab1141e.js";import{m as B}from"./index-1ef2f010.js";const Y=R({__name:"HandleUserModal",props:{type:{},id:{}},emits:["success"],setup(n,{expose:i,emit:p}){const a=n,o=l(!1),c=l(),d=N(()=>a.type==="edit"?"编辑用户":"新增用户"),r=l([{field:"username",component:"NInput",label:"用户名",componentProps:{placeholder:"请输入用户名"},rules:[{required:!0,message:"请输入用户名",trigger:["blur"]}]},{field:"password",component:"NInput",label:"密码",componentProps:{placeholder:"请输入密码",type:"password"},rules:[{required:!0,message:"请输入密码",trigger:["blur"]}]},{field:"nickName",component:"NInput",label:"昵称",componentProps:{placeholder:"请输入昵称"},rules:[{required:!0,message:"请输入昵称",trigger:["blur"]}]},{field:"email",component:"NInput",label:"邮箱",componentProps:{placeholder:"请输入邮箱"}},{field:"roleIds",component:"NSelect",label:"角色",componentProps:{placeholder:"请选择角色",options:[],labelField:"name",valueField:"id",multiple:!0},rules:[{type:"array",required:!0,message:"请选择角色",trigger:["blur"]}]}]),[u,{setFieldsValue:m,setProps:f,validate:g}]=y({schemas:r.value});P(()=>o.value,async e=>{if(e&&(await h(),a.id)){const s=await C(a.id);f({schemas:r.value.filter(b=>b.field!=="password")}),m(s)}});async function w(e){await g();try{a.type==="edit"?a.id&&await k(a.id,e):await q({...e,password:B(e.password)}),t(),p("success")}catch(s){console.error("捕获到的错误:",s)}}async function h(){const e=await S();U(r.value[4].componentProps||{},{options:e})}function t(){o.value=!o.value}return i({toggleModal:t}),(e,s)=>(F(),I(v,{ref_key:"modalRef",ref:c,title:d.value,footer:!1,show:o.value,onCancel:t},{default:x(()=>[A(_,{onRegister:M(u),onSubmit:w},null,8,["onRegister"])]),_:1},8,["title","show"]))}});export{Y as _};
